<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>TradingBot Dashboard</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css">
</head>
<body class="bg-light">
<div class="container py-4">
  <h1 class="mb-3">TradingBot</h1>

  <div class="card mb-3">
    <div class="card-body d-flex justify-content-between align-items-center">
      <div>
        <div><strong>Status:</strong>
          {% if status.running %}<span class="text-success">Running</span>{% else %}<span class="text-danger">Stopped</span>{% endif %}
        </div>
        <div><strong>Source:</strong> {{ status.source }}</div>
        <div><strong>Symbols:</strong> {{ status.symbols|join(", ") }}</div>
        <div><strong>Timeframes:</strong> {{ status.timeframes|join(", ") }}</div>
        <div><strong>Poll:</strong> {{ status.poll_sec }}s</div>
      </div>
      <div>
        <form method="post" action="{{ url_for('routes.start') }}" class="d-inline">
          <button class="btn btn-success" {% if status.running %}disabled{% endif %}>Start</button>
        </form>
        <form method="post" action="{{ url_for('routes.stop') }}" class="d-inline">
          <button class="btn btn-outline-danger" {% if not status.running %}disabled{% endif %}>Stop</button>
        </form>
      </div>
    </div>
  </div>

  <div class="card mb-3">
    <div class="card-header">Settings</div>
    <div class="card-body">
      <form method="post" action="{{ url_for('routes.strategy_post') }}" class="row g-3">
        <div class="col-md-5">
          <label class="form-label">Symbols (comma separated)</label>
          <input name="symbols" class="form-control" value="{{ status.symbols|join(',') }}">
        </div>
        <div class="col-md-5">
          <label class="form-label">Timeframes</label>
          <input name="timeframes" class="form-control" value="{{ status.timeframes|join(',') }}">
        </div>
        <div class="col-md-2">
          <label class="form-label">Data source</label>
          <select name="source" class="form-select">
            <option value="gate" {{ 'selected' if status.source == 'gate' else '' }}>Gate.io (spot)</option>
            <option value="binance" {{ 'selected' if status.source == 'binance' else '' }}>Binance (spot)</option>
          </select>
        </div>
        <div class="col-md-2">
          <label class="form-label">Poll (s)</label>
          <input name="poll" type="number" min="10" class="form-control" value="{{ status.poll_sec }}">
        </div>
        <div class="col-12">
          <button class="btn btn-primary">Update</button>
        </div>
      </form>
    </div>
  </div>

  <div class="card">
    <div class="card-header">Latest Signals</div>
    <div class="table-responsive">
      <table class="table table-sm mb-0">
        <thead class="table-light">
        <tr><th>Time</th><th>Pair</th><th>TF</th><th>Message</th></tr>
        </thead>
        <tbody id="signals-body">
        {% for s in status.signals %}
          <tr>
            <td>{{ s.ts }}</td>
            <td>{{ s.pair }}</td>
            <td>{{ s.tf }}</td>
            <td>{{ s.msg }}</td>
          </tr>
        {% endfor %}
        </tbody>
      </table>
    </div>
  </div>

</div>

<script>
  // simple auto-refresh of signals every 10s
  setInterval(async () => {
    const res = await fetch('{{ url_for("routes.signals_json") }}');
    const data = await res.json();
    const body = document.getElementById('signals-body');
    body.innerHTML = '';
    for (const s of data.signals) {
      const tr = document.createElement('tr');
      const dt = new Date(s.ts * 1000).toLocaleString();
      tr.innerHTML = `<td>${dt}</td><td>${s.pair}</td><td>${s.tf}</td><td>${s.msg}</td>`;
      body.appendChild(tr);
    }
  }, 10000);
</script>
</body>
</html>
